<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Listen1 Manager</title>

    <link rel="stylesheet" href="./assets/css/elementui.css">
    <link rel="stylesheet" href="./assets/css/custom.css">
    <script src="./lib/vue.min.js"></script>
    <script src="./lib/elementui.min.js"></script>

</head>

<body>
<!--vue调用ng-->
<div id="listen1NgApi" ng-app="listen1NgApi" ng-controller="listen1NgApiController">
</div>
<!--TODO:启动时loading-->
<div id="app">
    <el-dialog :visible.sync="addAndEditDialogVisible"
               width="80%"
               height="80%"
               :close-on-click-modal="false"
               :center="true">
        <span slot="title" class="el-dialog__title">
            <div v-if="isAdd">添加</div>
            <div v-if="!isAdd">正在编辑"{{currentModifyRow.title}}"</div>
        </span>
        <add-edit-dialog-content
                ref="add-edit-dialog-content"
                :track="currentModifyRow"
                :isadd="isAdd"
                @selected="handleEditComplete"
                @added="handleAdded"
                @play="playByTrack">
        </add-edit-dialog-content>
        <span slot="footer" class="dialog-footer">
            <el-button @click="addAndEditDialogVisible = false">关闭窗口</el-button>
        </span>
    </el-dialog>
    <el-dialog
            title="批量导入"
            :visible.sync="importDialogVisible"
            width="80%"
            height="80%"
            :close-on-click-modal="false"
            :center="true"
    >

        <import-dialog-content
                ref="import-dialog-content"
                @play="playByTrack"
                @imported="handleImportedFromList">
        </import-dialog-content>
        <span slot="footer" class="dialog-footer">
            <el-button @click="importDialogVisible = false">关闭窗口</el-button>
        </span>
    </el-dialog>

    <el-container>
        <el-main>

            <el-tabs v-model="activeTabName">
                <el-tab-pane name="Manager">
                    <span slot="label"><i class="el-icon-edit"></i> Manager</span>

                    <!--{{listen1Configs}}-->

                    <!--编辑歌单-->

                    <p>歌单:
                        <el-select v-model="currentPlayListId" placeholder="请选择歌单">
                            <el-option
                                    v-for="playList in myPlaylists"
                                    :key="playList.info.id"
                                    :label="playList.info.title + '(' + playList.info.id + ')'"
                                    :value="playList.info.id">
                            </el-option>
                        </el-select>
                    </p>

                    <div v-if="currentPlayListId!=''">


                        <template>
                            <el-table
                                    ref="playListTable"
                                    :data="playListTableData"
                                    border
                                    max-height="480"
                                    style="width: 100%">
                                <el-table-column
                                        type="index"
                                        fixed="left"
                                        width="50">
                                </el-table-column>
                                <el-table-column
                                        prop="source"
                                        label="来源"
                                        width="100">
                                </el-table-column>
                                <el-table-column
                                        prop="title"
                                        label="歌名"
                                        width="180">
                                    <template slot-scope="scope">
                                        {{ scope.row.title }}
                                        <br>
                                        <el-popover trigger="hover" placement="top">
                                            <div slot="reference" class="name-wrapper">
                                                <el-tag size="medium">{{scope.row.id}}</el-tag>
                                            </div>
                                            <div v-html="scope.row">

                                            </div>
                                        </el-popover>
                                    </template>
                                </el-table-column>
                                <el-table-column
                                        prop="artist"
                                        label="歌手"
                                        width="180">
                                    <template slot-scope="scope">
                                        {{ scope.row.artist }}
                                        <br>
                                        <el-tag size="medium">{{scope.row.artist_id}}</el-tag>

                                    </template>
                                </el-table-column>
                                <el-table-column
                                        prop="album"
                                        label="专辑"
                                        width="300">
                                    <template slot-scope="scope">
                                        {{ scope.row.album }}
                                        <br>
                                        <el-tag size="medium">{{scope.row.album_id}}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column
                                        prop="status"
                                        label="状态"
                                        width="180">
                                    <template slot-scope="scope">
                                        {{status[scope.$index]}}
                                        {{scope.$index}}
                                    </template>
                                </el-table-column>
                                <el-table-column
                                        fixed="right"
                                        label="操作"
                                >
                                    <template slot-scope="scope">
                                        <el-button icon="el-icon-edit" size="mini"
                                                   @click="openEditDialog(scope.$index)">编辑
                                        </el-button>
                                        <el-button type="primary" size="mini" icon="el-icon-service"
                                                   @click="playByTrack(scope.row)">试听
                                        </el-button>
                                        <el-button type="danger" size="mini" icon="el-icon-delete"
                                                   @click="handleDeleteRow(scope.$index)">删除
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </template>

                        <div class="control-buttons">
                            <el-button type="primary" round @click="openAddDialog">添加</el-button>
                            <el-button type="primary" round @click="openImportDialog">导入</el-button>
                            <!--TODO:整理导出功能-->
                            <el-button type="primary" round @click="handleExport">导出</el-button>
                            <el-button type="primary" round @click="handleDownloadAll">开始下载</el-button>
                        </div>

                    </div>
                </el-tab-pane>
                <el-tab-pane name="Listen1">
                    <span slot="label"><i class="el-icon-service"></i>Listen1</span>

                    <iframe id="listen1_iframe" src="./listen1_chrome_extension/listen1.html"
                            style="width:100vw;height:45vw;"></iframe>
                </el-tab-pane>

            </el-tabs>
        </el-main>

    </el-container>


</div>

<!--Listen1相关-->
<script type="text/javascript" src="./listen1_chrome_extension/js/vendor/jquery-2.2.3.min.js"></script>
<script type="text/javascript" src="./listen1_chrome_extension/js/vendor/angular.min.js"></script>
<!--<script type="text/javascript" src="./listen1_chrome_extension/js/vendor/angular-soundmanager2.js"></script>-->
<!--<script type="text/javascript" src="./listen1_chrome_extension/js/vendor/angular-ui-notification.js"></script>-->
<!--<script type="text/javascript" src="./listen1_chrome_extension/js/vendor/hotkeys.js"></script>-->
<script type="text/javascript" src="./listen1_chrome_extension/js/vendor/md5.js"></script>
<script type="text/javascript" src="./listen1_chrome_extension/js/vendor/aes.js"></script>
<script type="text/javascript" src="./listen1_chrome_extension/js/vendor/bigint.js"></script>
<!--<script type="text/javascript" src="./listen1_chrome_extension/js/vendor/timer.js"></script>-->

<!--<script type="text/javascript" src="./listen1_chrome_extension/js/github_api.js"></script>-->
<!--<script type="text/javascript" src="./listen1_chrome_extension/js/github.js"></script>-->
<!--<script type="text/javascript" src="./listen1_chrome_extension/js/lastfm.js"></script>-->

<script type="text/javascript" src="./listen1_chrome_extension/js/lowebutil.js"></script>
<script type="text/javascript" src="./listen1_chrome_extension/js/provider/xiami.js"></script>
<script type="text/javascript" src="./listen1_chrome_extension/js/provider/qq.js"></script>
<script type="text/javascript" src="./listen1_chrome_extension/js/provider/netease.js"></script>
<script type="text/javascript" src="./listen1_chrome_extension/js/myplaylist.js"></script>
<script type="text/javascript" src="./listen1_chrome_extension/js/loweb.js"></script>
<!--<script type="text/javascript" src="./listen1_chrome_extension/js/app.js"></script>-->


</body>

<script type="text/javascript">
    // for listen1
    Storage.prototype.setObject = function (key, value) {
        this.setItem(key, JSON.stringify(value));
    };
    Storage.prototype.getObject = function (key) {
        let value = this.getItem(key);
        return value && JSON.parse(value);
    };
</script>

<script src="./app.js"></script>
</html>